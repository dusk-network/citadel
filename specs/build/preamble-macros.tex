% ===== SETTINGS =====
\pagestyle{plain}

% Margins
\textwidth 18 cm
\textheight 22 cm
\topmargin -1 cm
\oddsidemargin -1 cm

% Directories
\newcommand{\definedir}[2]{\newcommand{#1}{#2}}
\definedir{\secs}{../secs}
\definedir{\figs}{../images}

% Style
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}
\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},   
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\normalsize,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2
}
\lstset{style=mystyle}

% Footnote style
\let\svthefootnote\thefootnote
\newcommand\freefootnote[1]{%
  \let\thefootnote\relax%
  \footnotetext{#1}%
  \let\thefootnote\svthefootnote%
}

\setlength{\skip\footins}{2pc}

%Enumerate (1 -> 1.1 -> 1.1.1)
\renewcommand{\labelenumii}{\theenumii}
\renewcommand{\theenumii}{\theenumi.\arabic{enumii}.}

% ===== MACROS =====

% Comments
\newcommand{\todotag}{\sethlcolor{red}\hl{ to-do }\xspace}
\newcommand{\js}[1]{{\todo[size=\small, color=blue!40]{Javier: #1}}}
\newcommand{\jsi}[1]{{\todo[inline, size=\small, color=blue!40]{Javier: #1}}}
\newcommand{\mb}[1]{{\todo[size=\small, color=red!40]{Marta: #1}}}
\newcommand{\mbi}[1]{{\todo[inline, size=\small, color=red!40]{Marta: #1}}}
\newcommand{\dk}[1]{{\todo[size=\small, color=orange!40]{Dmitry: #1}}}
\newcommand{\dki}[1]{{\todo[inline, size=\small, color=orange!40]{Dmitry: #1}}}
\newcommand{\zp}[1]{{\todo[size=\small, color=red!40]{Zaira: #1}}}
\newcommand{\zpi}[1]{{\todo[inline, size=\small, color=green!40]{Zaira: #1}}}
\newcommand{\xs}[1]{{\todo[size=\small, color=red!40]{Xavier: #1}}}
\newcommand{\xsi}[1]{{\todo[inline, size=\small, color=purple!40]{Xavier: #1}}}

% Hyperlinks
\newcommand{\hlset}[1]{\hypertarget{\detokenize{#1}}{#1}}
\newcommand{\hlget}[1]{\hyperlink{\detokenize{#1}}{#1}}

% Mathbb
\newcommand{\N}{\mathbb{N}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\E}{\mathbb{E}}
\newcommand{\F}{\mathbb{F}}
\newcommand{\G}{\mathbb{G}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\J}{\mathbb{J}}
\newcommand{\B}{\mathbb{B}}

% Mathsf
\newcommand{\klic}{\mathsf{k_{lic}}}
\newcommand{\kreq}{\mathsf{k_{req}}}
\newcommand{\kdh}{\mathsf{k_{DH}}}
\newcommand{\ksym}{\mathsf{k}}
\newcommand{\tkdh}{\mathsf{\tilde{k}_{DH}}}
\newcommand{\tklic}{\mathsf{\tilde{k}_{lic}}}
\newcommand{\tkreq}{\mathsf{\tilde{k}_{req}}}
\newcommand{\sk}{\mathsf{sk}}
\newcommand{\pk}{\mathsf{pk}}
\newcommand{\ck}{\mathsf{ck}}
\renewcommand{\pk}{\mathsf{pk}}
\newcommand{\vk}{\mathsf{vk}}
\newcommand{\npk}{\mathsf{npk}}
\newcommand{\user}{\mathsf{user}}
\newcommand{\NFT}{\mathsf{NFT}}
\newcommand{\LP}{\mathsf{LP}}
\newcommand{\SP}{\mathsf{SP}}
\newcommand{\npkn}[1]{\mathsf{npk}_{#1}}
\newcommand{\nsk}{\mathsf{nsk}}
\newcommand{\lsk}{\mathsf{lsk}}
\newcommand{\lpk}{\mathsf{lpk}}
\newcommand{\rpk}{\mathsf{rpk}}
\newcommand{\spk}{\mathsf{spk}}
\newcommand{\tx}{\mathsf{tx}}
\newcommand{\txold}{\mathsf{tx^{old}}}
\newcommand{\txm}{\mathsf{tx_{metadata}}}
\newcommand{\txp}{\mathsf{tx_{payload}}}
\newcommand{\txh}{\mathsf{tx_{hash}}}
\newcommand{\txproof}{\mathsf{tx_{proof}}}
\newcommand{\Note}{\mathsf{N}}
\newcommand{\lic}{\mathsf{lic}}
\newcommand{\req}{\mathsf{req}}
\newcommand{\Session}{\mathsf{session}}
\newcommand{\SessionCookie}{\mathsf{sc}}
\newcommand{\nfthash}{\mathsf{hash_{NFT}}}
\newcommand{\nftpayload}{\mathsf{payload_{NFT}}}
\newcommand{\sig}{\mathsf{sig}}
\newcommand{\lsig}{\mathsf{sig_{lic}}}
\newcommand{\tsig}{\mathsf{sig_{tx}}}
\newcommand{\attr}{\mathsf{attr}}
\newcommand{\attrdata}{\mathsf{attr\_data}}
\newcommand{\sign}{\mathsf{sign\_single\_key}}
\newcommand{\signd}{\mathsf{sign\_double\_key}}
\newcommand{\verify}{\mathsf{verify\_sig\_single\_key}}
\newcommand{\verifyd}{\mathsf{verify\_sig\_double\_key}}
\newcommand{\mintnft}{\mathsf{mint\_nft}}
\newcommand{\NoteB}{\mathsf{N_{B}}}
\newcommand{\NoteC}{\mathsf{N_{C}}}
\newcommand{\nnew}[1]{\mathsf{N^{new}_{#1}}}
\newcommand{\nold}[1]{\mathsf{N^{old}_{#1}}}
\newcommand{\vnew}[1]{\mathsf{v_{#1}}}
\newcommand{\vold}[1]{\mathsf{w_{#1}}}
\newcommand{\change}{\mathsf{change}}
\newcommand{\type}{\mathsf{type}}
\newcommand{\com}{\mathsf{com}}
\newcommand{\enc}{\mathsf{enc}}
\newcommand{\nonce}{\mathsf{nonce}}
\newcommand{\pos}{\mathsf{pos}}
\newcommand{\nullifier}{\mathsf{nullifier}}
\newcommand{\isseen}{\mathsf{is\_seen}}
\newcommand{\pnullifiers}{\mathsf{previous\_nullifiers}}
\newcommand{\sessionid}{\mathsf{session\_id}}
\newcommand{\hb}{H^\mathsf{BLAKE2b}}
\newcommand{\hp}{H^\mathsf{Poseidon}}

% Mathfrak
\newcommand{\Ftuple}{\mathfrak{F}}
\newcommand{\Bitstrings}{\mathfrak{B}}

% Misc maths
\newcommand{\floor}[1]{\lfloor #1 \rfloor}
\newcommand{\ceil}[1]{\lceil #1 \rceil}

% Misc cryptography
\newcommand{\sample}{\xleftarrow{\$}}
\newcommand{\error}{\perp}
\newcommand{\conc}{\;||\;}
\newcommand{\snull}{\sf{null}}

% Building blocks
\renewcommand{\SS}{\sf{S}}
\newcommand{\EE}{\sf{E}}
\newcommand{\CC}{\sf{C}}
\newcommand{\PP}{\sf{P}}
\newcommand{\MT}{\sf{MT}}
\newcommand{\NN}{\sf{N}}

% Cryptographic algorithms
\newcommand{\Setup}{\sf{Setup}}
\newcommand{\SetupU}{\sf{SetupUniversal}} % find a better one
\newcommand{\SetupD}{\sf{SetupDependent}} % find a better one
\newcommand{\Com}{\sf{Com}}
\newcommand{\Hash}{\sf{Hash}}
\newcommand{\Enc}{\sf{Enc}}
\newcommand{\Dec}{\sf{Dec}}
\newcommand{\SDec}{\sf{SymDec}}
\newcommand{\Sign}{\sf{Sign}}
\newcommand{\Prove}{\sf{Prove}}
\newcommand{\Verify}{\sf{Verify}}
\newcommand{\Nul}{\sf{Nullify}}
\newcommand{\Open}{\sf{Open}}
\newcommand{\UpdateCom}{\sf{UpdateCom}}
\newcommand{\UpdateProof}{\sf{UpdateProof}}

% Misc
\newcommand{\secparam}{\sf{security_parameter}}
\newcommand{\vin}{\sf{in}}
\newcommand{\vout}{\sf{out}}
\newcommand{\msg}[1][]{\sf{message}^{#1}}
\newcommand{\accept}{\sf{accept}}
\newcommand{\reject}{\sf{reject}}
\newcommand{\pp}{\sf{pp}}
\newcommand{\crs}{\sf{crs}} % do we need both CRS and SRS?
\newcommand{\srs}{\sf{srs}}
\newcommand{\transfer}{\sf{transfer}}
\newcommand{\length}{\sf{length}}

% State
\newcommand{\holders}{\sf{holders}}
\newcommand{\securities}{\sf{securities}}
\newcommand{\nullifiers}{\sf{usedNullifiers}}
\newcommand{\vmax}{\sf{max}}
\newcommand{\vsupply}{\sf{supply}}
\newcommand{\vlimit}{\sf{limit}}

% Roles
\newcommand{\holder}{\sf{holder}}
\newcommand{\issuer}{\sf{issuer}}
\newcommand{\auditor}{\sf{auditor}}
\newcommand{\sender}{\sf{sender}}
\newcommand{\recipient}{\sf{recipient}}
\newcommand{\viewer}{\sf{viewer}}

% Merkle trees / Merkle proofs
\newcommand{\tree}[1][]{\sf{tree}^{\sf{#1}}}
\renewcommand{\root}[1][]{\sf{root}^{\sf{#1}}}
\newcommand{\recentroots}{\sf{recentRoots}}
\newcommand{\leaf}{\sf{leaf}}
\newcommand{\leaves}{\sf{leaves}}

% Circuits
\newcommand{\inputs}{\sf{input}}
\newcommand{\public}{\sf{public}}
\newcommand{\secret}{\sf{secret}}

% Values
\newcommand{\val}[1][]{\sf{value}^{#1}}

% Keys and key components
\newcommand{\SK}{\sf{SecretKey}}
\newcommand{\PK}{\sf{PublicKey}}
\newcommand{\seed}{\sf{seed}}
\renewcommand{\k}[1][]{\sf{k}^{#1}}
\newcommand{\spend}{\sf{spend}}
\newcommand{\view}{\sf{view}}
\newcommand{\nullify}{\sf{nullify}}
\newcommand{\token}{\sf{token}}

% Securities
\newcommand{\content}[1]{\sf{content}^{#1}}
\newcommand{\blinder}[1][]{\sf{blinder}^{#1}}
\newcommand{\bitmask}[1][]{\sf{bitmask}^{#1}}
\newcommand{\opening}[1][]{\sf{opening}^{#1}}

% Contract methods
\newcommand{\cAdd}{\sf{AddToAllowlist}}
\newcommand{\cRemove}{\sf{RemoveFromAllowlist}}
\newcommand{\cMint}{\sf{Mint}}
\newcommand{\cBurn}{\sf{Burn}}
\newcommand{\cTransfer}{\sf{Transfer}}
\newcommand{\cForced}{\sf{ForcedTransfer}}

% Wallet functionalities
\newcommand{\wKeys}{\sf{CreateKeys}}
\newcommand{\wOutput}{\sf{ComputeOutput}}
\newcommand{\wNul}{\sf{ComputeNullifier}}
\newcommand{\wComTransfer}{\sf{ComputeTransferCommitment}}
\newcommand{\wComSwap}{\sf{ComputeSwapCommitment}}
\newcommand{\wSign}{\sf{ComputeSpendingAuthorization}}
\newcommand{\wMProof}{\sf{ComputeMembershipProof}}
\newcommand{\wProof}{\sf{ComputeTransferProof}}
\newcommand{\wDecViewer}{\sf{DecryptByViewer}}
\newcommand{\wDecOutAuditor}{\sf{DecryptOutputByAuditor}}
\newcommand{\wDecNulAuditor}{\sf{DecryptNullifierByAuditor}}

% Atomic swaps
\newcommand{\maker}{\sf{maker}}
\newcommand{\taker}{\sf{taker}}
\newcommand{\seca}{\sf{A}}
\newcommand{\secb}{\sf{B}}
\newcommand{\secx}{x}
\newcommand{\swap}{\sf{swap}}
\newcommand{\xmax}[1][]{\sf{X}^{#1}}
\newcommand{\contract}[1][]{\sf{contract}^{#1}}
\newcommand{\this}{\sf{this}}
\newcommand{\swapdata}[1][]{\sf{swapData}^{#1}}
\newcommand{\transferdata}[1][]{\sf{transferData}^{#1}}

% Indices
\newcommand{\ai}{\seca, i}
\newcommand{\bi}{\secb, i}
\renewcommand{\xi}{\secx, i}
\newcommand{\fii}{i = 1, 2}
\newcommand{\fio}{i = 3, 4}
\newcommand{\fs}{\secx = \seca, \secb}
\newcommand{\falli}{{\substack{x = \seca, \secb \\ i = 1, 2}}}
\newcommand{\fallo}{{\substack{x = \seca, \secb \\ i = 3, 4}}}

% Entity tags
\newcommand{\tagauditor}{\sethlcolor{yellow}\hl{ auditor }\xspace}
\newcommand{\tagissuer}{\sethlcolor{orange}\hl{ issuer }\xspace}
\newcommand{\tagholders}{\sethlcolor{cyan}\hl{ holders }\xspace}
\newcommand{\tagwhitelisted}{\sethlcolor{brown}\hl{ whitelisted }\xspace}
\newcommand{\tagviewer}{\sethlcolor{lime}\hl{ viewer }\xspace}

% Symbols
\newcommand{\cmark}{\ding{51}}%
\newcommand{\xmark}{\ding{55}}%

% Formatting
\newcommand{\method}[1]{\noindent{#1}}
\newcommand{\textmc}[1]{\textsc{\scalefont{1}#1}}
\newcommand{\tinputs}{\textmc{inputs}{ }}
\newcommand{\tproc}{\textmc{procedure}{ }}
\newcommand{\toutputs}{\textmc{outputs}{ }}
\lstnewenvironment{code}[1][]%
  {\noindent\minipage{\linewidth}\medskip 
   \lstset{basicstyle=\fontsize{8}{8}\selectfont\ttfamily,frame=single,#1,backgroundcolor=\color{white}}}
  {\endminipage}

% Miscallaneous
\newcommand\mut[1]{\ignorespaces}
\renewcommand{\sf}[1]{\ensuremath{\mathsf{#1}}}
\renewcommand{\tt}[1]{\texttt{#1}}